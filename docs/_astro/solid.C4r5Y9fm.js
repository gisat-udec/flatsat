const o={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Q(this.context.count)},getNextContextId(){return Q(this.context.count++)}};function Q(e){const t=String(e),s=t.length-1;return o.context.id+(s?String.fromCharCode(96+s):"")+t}function E(e){o.context=e}function le(){return{...o.context,id:o.getNextContextId(),count:0}}const ue=(e,t)=>e===t,Ce=Symbol("solid-proxy"),oe=Symbol("solid-track"),R={equals:ue};let X=ee;const k=1,T=2,Y={owned:null,cleanups:null,context:null,owner:null};var i=null;let K=null,ie=null,f=null,h=null,m=null,M=0;function P(e,t){const s=f,n=i,r=e.length===0,u=t===void 0?n:t,c=r?Y:{owned:null,cleanups:null,context:u?u.context:null,owner:u},p=r?e:()=>e(()=>O(()=>N(c)));i=c,f=null;try{return $(p,!0)}finally{f=s,i=n}}function V(e,t){t=t?Object.assign({},R,t):R;const s={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),q(s,r));return[_.bind(s),n]}function ce(e,t,s){const n=G(e,t,!1,k);U(n)}function Ae(e,t,s){X=be;const n=G(e,t,!1,k),r=j&&Z(j);r&&(n.suspense=r),n.user=!0,m?m.push(n):U(n)}function I(e,t,s){s=s?Object.assign({},R,s):R;const n=G(e,t,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,U(n),_.bind(n)}function ke(e){return $(e,!1)}function O(e){if(f===null)return e();const t=f;f=null;try{return e()}finally{f=t}}function z(e){return i===null||(i.cleanups===null?i.cleanups=[e]:i.cleanups.push(e)),e}function Ee(){return f}function fe(){return i}function ae(e){m.push.apply(m,e),e.length=0}function J(e,t){const s=Symbol("context");return{id:s,Provider:xe(s),defaultValue:e}}function Z(e){let t;return i&&i.context&&(t=i.context[e.id])!==void 0?t:e.defaultValue}function pe(e){const t=I(e),s=I(()=>B(t()));return s.toArray=()=>{const n=s();return Array.isArray(n)?n:n!=null?[n]:[]},s}let j;function he(){return j||(j=J())}function _(){if(this.sources&&this.state)if(this.state===k)U(this);else{const e=h;h=null,$(()=>H(this),!1),h=e}if(f){const e=this.observers?this.observers.length:0;f.sources?(f.sources.push(this),f.sourceSlots.push(e)):(f.sources=[this],f.sourceSlots=[e]),this.observers?(this.observers.push(f),this.observerSlots.push(f.sources.length-1)):(this.observers=[f],this.observerSlots=[f.sources.length-1])}return this.value}function q(e,t,s){let n=e.value;return(!e.comparator||!e.comparator(n,t))&&(e.value=t,e.observers&&e.observers.length&&$(()=>{for(let r=0;r<e.observers.length;r+=1){const u=e.observers[r],c=K&&K.running;c&&K.disposed.has(u),(c?!u.tState:!u.state)&&(u.pure?h.push(u):m.push(u),u.observers&&te(u)),c||(u.state=k)}if(h.length>1e6)throw h=[],new Error},!1)),t}function U(e){if(!e.fn)return;N(e);const t=M;de(e,e.value,t)}function de(e,t,s){let n;const r=i,u=f;f=i=e;try{n=e.fn(t)}catch(c){return e.pure&&(e.state=k,e.owned&&e.owned.forEach(N),e.owned=null),e.updatedAt=s+1,ne(c)}finally{f=u,i=r}(!e.updatedAt||e.updatedAt<=s)&&(e.updatedAt!=null&&"observers"in e?q(e,n):e.value=n,e.updatedAt=s)}function G(e,t,s,n=k,r){const u={fn:e,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:i,context:i?i.context:null,pure:s};return i===null||i!==Y&&(i.owned?i.owned.push(u):i.owned=[u]),u}function D(e){if(e.state===0)return;if(e.state===T)return H(e);if(e.suspense&&O(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<M);)e.state&&t.push(e);for(let s=t.length-1;s>=0;s--)if(e=t[s],e.state===k)U(e);else if(e.state===T){const n=h;h=null,$(()=>H(e,t[0]),!1),h=n}}function $(e,t){if(h)return e();let s=!1;t||(h=[]),m?s=!0:m=[],M++;try{const n=e();return ge(s),n}catch(n){s||(m=null),h=null,ne(n)}}function ge(e){if(h&&(ee(h),h=null),e)return;const t=m;m=null,t.length&&$(()=>X(t),!1)}function ee(e){for(let t=0;t<e.length;t++)D(e[t])}function be(e){let t,s=0;for(t=0;t<e.length;t++){const n=e[t];n.user?e[s++]=n:D(n)}if(o.context){if(o.count){o.effects||(o.effects=[]),o.effects.push(...e.slice(0,s));return}E()}for(o.effects&&(o.done||!o.count)&&(e=[...o.effects,...e],s+=o.effects.length,delete o.effects),t=0;t<s;t++)D(e[t])}function H(e,t){e.state=0;for(let s=0;s<e.sources.length;s+=1){const n=e.sources[s];if(n.sources){const r=n.state;r===k?n!==t&&(!n.updatedAt||n.updatedAt<M)&&D(n):r===T&&H(n,t)}}}function te(e){for(let t=0;t<e.observers.length;t+=1){const s=e.observers[t];s.state||(s.state=T,s.pure?h.push(s):m.push(s),s.observers&&te(s))}}function N(e){let t;if(e.sources)for(;e.sources.length;){const s=e.sources.pop(),n=e.sourceSlots.pop(),r=s.observers;if(r&&r.length){const u=r.pop(),c=s.observerSlots.pop();n<r.length&&(u.sourceSlots[c]=n,r[n]=u,s.observerSlots[n]=c)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)N(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)N(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function we(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ne(e,t=i){throw we(e)}function B(e){if(typeof e=="function"&&!e.length)return B(e());if(Array.isArray(e)){const t=[];for(let s=0;s<e.length;s++){const n=B(e[s]);Array.isArray(n)?t.push.apply(t,n):t.push(n)}return t}return e}function xe(e,t){return function(n){let r;return ce(()=>r=O(()=>(i.context={...i.context,[e]:n.value},pe(()=>n.children))),void 0),r}}const ye=Symbol("fallback");function W(e){for(let t=0;t<e.length;t++)e[t]()}function ve(e,t,s={}){let n=[],r=[],u=[],c=0,p=t.length>1?[]:null;return z(()=>W(u)),()=>{let x=e()||[],w=x.length,a,l;return x[oe],O(()=>{let d,v,g,A,S,b,y,C,F;if(w===0)c!==0&&(W(u),u=[],n=[],r=[],c=0,p&&(p=[])),s.fallback&&(n=[ye],r[0]=P(re=>(u[0]=re,s.fallback())),c=1);else if(c===0){for(r=new Array(w),l=0;l<w;l++)n[l]=x[l],r[l]=P(L);c=w}else{for(g=new Array(w),A=new Array(w),p&&(S=new Array(w)),b=0,y=Math.min(c,w);b<y&&n[b]===x[b];b++);for(y=c-1,C=w-1;y>=b&&C>=b&&n[y]===x[C];y--,C--)g[C]=r[y],A[C]=u[y],p&&(S[C]=p[y]);for(d=new Map,v=new Array(C+1),l=C;l>=b;l--)F=x[l],a=d.get(F),v[l]=a===void 0?-1:a,d.set(F,l);for(a=b;a<=y;a++)F=n[a],l=d.get(F),l!==void 0&&l!==-1?(g[l]=r[a],A[l]=u[a],p&&(S[l]=p[a]),l=v[l],d.set(F,l)):u[a]();for(l=b;l<w;l++)l in g?(r[l]=g[l],u[l]=A[l],p&&(p[l]=S[l],p[l](l))):r[l]=P(L);r=r.slice(0,c=w),n=x.slice(0)}return r});function L(d){if(u[l]=d,p){const[v,g]=V(l);return p[l]=g,t(x[l],v)}return t(x[l])}}}let se=!1;function Fe(){se=!0}function me(e,t){if(se&&o.context){const s=o.context;E(le());const n=O(()=>e(t||{}));return E(s),n}return O(()=>e(t||{}))}function Ie(e){const t="fallback"in e&&{fallback:()=>e.fallback};return I(ve(()=>e.each,e.children,t||void 0))}const Se=J();function Oe(e){let t=0,s,n,r,u,c;const[p,x]=V(!1),w=he(),a={increment:()=>{++t===1&&x(!0)},decrement:()=>{--t===0&&x(!1)},inFallback:p,effects:[],resolved:!1},l=fe();if(o.context&&o.load){const v=o.getContextId();let g=o.load(v);if(g&&(typeof g!="object"||g.status!=="success"?r=g:o.gather(v)),r&&r!=="$$f"){const[A,S]=V(void 0,{equals:!1});u=A,r.then(()=>{if(o.done)return S();o.gather(v),E(n),S(),E()},b=>{c=b,S()})}}const L=Z(Se);L&&(s=L.register(a.inFallback));let d;return z(()=>d&&d()),me(w.Provider,{value:a,get children(){return I(()=>{if(c)throw c;if(n=o.context,u)return u(),u=void 0;n&&r==="$$f"&&E();const v=I(()=>e.children);return I(g=>{const A=a.inFallback(),{showContent:S=!0,showFallback:b=!0}=s?s():{};if((!A||r&&r!=="$$f")&&S)return a.resolved=!0,d&&d(),d=n=r=void 0,ae(a.effects),v();if(b)return d?g:P(y=>(d=y,n&&(E({id:n.id+"F",count:0}),n=void 0),e.fallback),l)})})}})}export{Ce as $,Ie as F,Oe as S,me as a,ce as b,Ae as c,P as d,Fe as e,oe as f,Ee as g,ke as h,V as i,o as s};
